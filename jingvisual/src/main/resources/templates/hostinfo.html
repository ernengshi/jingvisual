<!DOCTYPE HTML>
<html  xmlns="http://www.w3.org/1999/xhtml"
       xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
            <title>主机监控信息</title>
            <!--<script type="text/javascript" th:src="@{/webjars/jquery/3.2.1/jquery.min.js}"></script>-->
            <script type="text/javascript" th:src="@{/js/lib/script/jquery.js}"></script>
            <script type="text/javascript" th:src="@{/js/lib/script/highcharts.js}"></script>
            <script type="text/javascript" th:src="@{/js/lib/script/monitorChart.js}"></script>
            <!--<script type="text/javascript" th:src="@{/js/lib/script/host_CH211-241.js}"></script>-->
            <script th:inline="JavaScript">
                /*<![CDATA[*/
                function convertBytes(bytes) {
                if (bytes < 1024 * 1024) {
                return (bytes / 1024).toFixed(2) + " KB";
                } else if (bytes < 1024 * 1024 * 1024) {
                return (bytes / 1024 / 1024).toFixed(2) + " MB";
                } else if (bytes < 1024 * 1024 * 1024 * 1024) {
                return (bytes / 1024 / 1024 / 1024).toFixed(2) + " GB";
                } else {
                return (bytes / 1024 / 1024 / 1024 / 1024).toFixed(2) + " TB";
                }
                }
                $(function () {
                var args = {
                resource: ["cpu", "memory"],
                        title: function (resource) {
                        if (resource == "cpu") {
                        return "cpu信息";
                        } else if (resource == "memory") {
                        return  "内存信息";
                        }
                        },
                        chartDiv: function (resource) {
                        if (resource == "cpu") {
                        return "host_CH211-241_cpuchart";
                        } else if (resource == "memory") {
                        return  "host_CH211-241_memorychart";
                        }
                        },
                        charttype: function (resource) {
                        if (resource == "cpu") {
                        return "area";
                        } else if (resource == "memory") {
                        return  "area";
                        }
                        },
                        xtext: function (resource) {
                        return  "";
                        },
                        ytext: function (resource) {
                        if (resource == "cpu") {
                        return "";
                        } else if (resource == "memory") {
                        return  "";
                        }
                        },
                        yformatter: function (resource, yvalue) {
                        if (resource == "memory") {
                        return (yvalue / 1024 / 1024 / 1024).toFixed(2) + " GB ";
                        } else if (resource == "cpu") {
                        return yvalue + " % ";
                        }
                        },
                        tooltip: function (resource, chart) {
                        if (resource == "cpu") {

                        var content = '<span style="font-size: 12px;">' + Highcharts.dateFormat("%Y-%m-%d %H:%M:%S", chart.x) + '</span><br/>';
                        var yVal = (chart.point.y) ? (chart.point.y) + "%" : 0 + "%";
                        content += '<span style="color: ' + chart.point.series.color + '">' + chart.point.series.name + ": " + yVal + '</span> ' + '<br/>';
                        return content;
                        } else if (resource == "memory") {
                        var content = '<span style="font-size: 12px;">' + Highcharts.dateFormat("%Y-%m-%d %H:%M:%S", chart.x) + '</span><br/>';
                        var yVal = (chart.point.y) ? convertBytes(chart.point.y):0 + "KB";
                        content += '<span style="color: ' + chart.point.series.color + '">' + chart.point.series.name + ": " + yVal + '</span>' + '<br/>';
                        return content;
                        }
                        },
                        chartData: function (args) {
                        //var urlParam = "http://192.168.211.252:8096/client/api?command=listHostResourceGraphStats%26hostid=32666bd1-a6c3-4e28-bcca-4a40917c20e8%26timespan=HOUR%26size=100%26response=json";
                        var path = [[${ip}]] + ":" + [[${port}]];
                        var hostId = [[${hostId}]];
                        var urlParam = "http://" + path + "/client/api?command=listHostResourceGraphStats%26hostid=" + hostId + "%26timespan=HOUR%26size=100%26response=json";
                        $.ajax({
                        url: "/showZone?urlParam=" + urlParam,
                                dataType: "json",
                                async: false,
                                success: function (json) {
                                var hostChart = json.listhostresourcestatsresponse.hostresourcestats;
                                var available = [];
                                var resource = args.resource;
                                var date = [];
                                if (resource == "cpu") {
                                var cpuusage = [];
                                $.each(hostChart, function () {
                                available.push(this.available);
                                cpuusage.push(this.cpuusage);
                                date.push(this.date);
                                });
                                args.response.success({
                                chartTypeData: [{
                                data: cpuusage,
                                        typetext: "CPU占用率",
                                }],
                                        available: available,
                                        date: date,
                                });
                                } else if (resource == "memory") {
                                var ramfree = [];
                                var rambyvm = [];
                                var rambyplat = [];
                                $.each(hostChart, function () {
                                ramfree.push(this.ramfree);
                                rambyvm.push(this.rambyvm);
                                rambyplat.push(this.rambyplat);
                                available.push(this.available);
                                date.push(this.date);
                                });
                                args.response.success({
                                chartTypeData: [{
                                data: ramfree,
                                        typetext: "空闲内存",
                                },
                                {
                                data: rambyvm,
                                        typetext: "虚拟机使用内存",
                                },
                                {
                                data: rambyplat,
                                        typetext: "白金加速占用内存",
                                        color: "orange",
                                }],
                                        available: available,
                                        date: date,
                                });
                                }
                                }
                        });
                        },
                        chartCurrentApi: function (args) {
                        var path = [[${ip}]] + ":" + [[${port}]];
                        var hostId = [[${hostId}]];
                        //var urlParam = "http://192.168.211.252:8096/client/api?command=listHostResourceGraphStats%26hostid=32666bd1-a6c3-4e28-bcca-4a40917c20e8%26timespan=HOUR%26size=100%26response=json%26fetchlatest=true";
                        var urlParam = "http://" + path + "/client/api?command=listHostResourceGraphStats%26hostid=" + hostId + "%26timespan=HOUR%26size=100%26response=json%26fetchlatest=true";
                        $.ajax({
                        url: "/showZone?urlParam=" + urlParam,
                                dataType: "json",
                                async: false,
                                success: function (json) {
                                var resource = args.resource;
                                var hostChart = json.listhostresourcestatsresponse.hostresourcestats;
                                if (resource == "cpu") {
                                args.response.success({
                                chartCurrentData: [hostChart[0].cpuusage],
                                        currentAvailable: hostChart[0].available,
                                        currentDate: hostChart[0].date,
                                });
                                } else if (resource == "memory") {
                                args.response.success({
                                chartCurrentData: [hostChart[0].ramfree, hostChart[0].rambyvm, hostChart[0].rambyplat],
                                        currentAvailable: hostChart[0].available,
                                        currentDate: hostChart[0].date,
                                });
                                }
                                }
                        });
                        }
                };
                monitorChart(args);
                });
                /*]]>*/
            </script>
    </head>
    <body>
        <center>
            <b>主机监控信息</b>
            <table width="80%">
                <tr>
                    <td th:inline="text" colspan="3" align="center">主机 [[${hostId}]] [[${ip}]]</td>
                </tr>
                <tr>
                    <td width="50%"><div id='host_CH211-241_memorychart' style="width: 500px; height: 250px; margin: 0 auto"></div></td>
                    <td></td>
                    <td width="50%"><div id='host_CH211-241_cpuchart' style="width: 500px; height: 250px; margin: 0 auto"></div></td>
                </tr>
                <tr>
                    <td></td><td></td><td></td>
                </tr>
            </table>
        </center>
        <br/><br/><br/><br/><br/><br/><br/><br/><br/>
        <center>

            <!--<div th:replace="/common/_hostinfo :: memory" ></div>-->
        </center>


        <br/><br/><br/>
        <center>

            <!--<div th:replace="/common/_hostinfo :: cpu" ></div>-->
        </center>
    </body>
</html>